`if` ` ` `__name__` ` ` `==` ` ` `'__main__'` `:` `    ` `parser` ` ` `=` ` ` `argparse` `.` `ArgumentParser` `()` `    ` `parser` `.` `add_argument` `(` `'--color'` `,` ` ` `type` `=` `str` `)` `  ` `    ` `parser` `.` `add_argument` `(` `'--leak'` `,` ` ` `type` `=` `int` `,` ` ` `default` `=` `0` `)` `    ` `args` ` ` `=` ` ` `parser` `.` `parse_args` `()` `    ` `try` `:` `        ` `asyncio` `.` `run` `(` `main` `(` `args` `))` `    ` `except` ` ` `KeyboardInterrupt` `:` `        ` `print` `(` `'Leaving...'` `)` `        ` `ctx` `.` `term` `()` `  ` This coroutine function will run as a long-lived coroutine, continually sending out data to the server process. Create a ØMQ socket. As you know, there are different flavors of socket; this one is a  `PUB`  type, which allows one-way messages to be sent to another ØMQ socket. This socket has—as the ØMQ guide says—superpowers. It will automatically handle all reconnection and buffering logic for us. Connect to the server. Our shutdown sequence is driven by  `KeyboardInterrupt` , farther down. When that signal is received, all the tasks will be cancelled. Here I handle the raised `CancelledError`  with the handy  `suppress()`  context manager from the  `context` `lib`  standard library module. Iterate forever, sending out data to the server. Since ØMQ knows how to work with complete messages, and not just chunks off a bytestream, it opens the door to a bunch of useful wrappers around the usual `sock.send()`  idiom: here, I use one of those helper methods,  `send_json()` , which will automatically serialize the argument into JSON. This allows us to use a `dict()`  directly. A reliable way to transmit datetime information is via the ISO 8601 format. This is especially true if you have to pass datetime data between software written in different languages, since the vast majority of language implementations will be able to work with this standard. To end up here, we must have received the  `CancelledError`  exception resulting from task cancellation. The ØMQ socket must be closed to allow program shutdown. **104 ** **| ** **Chapter 4: 20 Asyncio Libraries You Aren’t Using (But…Oh, Never Mind)**