Contents The Evaluation Loop 154 Stack Frames . . . . . . . . . . . . . . . . . . . . . . . . 155 Related Source Files . . . . . . . . . . . . . . . . . . . . . 156 Important Terms . . . . . . . . . . . . . . . . . . . . . . 156 Constructing Thread State . . . . . . . . . . . . . . . . . 156 Constructing Frame Objects . . . . . . . . . . . . . . . . . 158 Frame Execution . . . . . . . . . . . . . . . . . . . . . . 166 The Value Stack . . . . . . . . . . . . . . . . . . . . . . . 169 Example: Adding an Item to a List . . . . . . . . . . . . . 175 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . 180 Memory Management 182 Memory Allocation in C . . . . . . . . . . . . . . . . . . . 182 Design of the Python Memory Management System . . . . 186 The CPython Memory Allocator . . . . . . . . . . . . . . . 188 The Object and PyMem Memory Allocation Domains . . . 198 The Raw Memory Allocation Domain . . . . . . . . . . . . 202 Custom Domain Allocators . . . . . . . . . . . . . . . . . 202 Custom Memory Allocation Sanitizers . . . . . . . . . . . 203 The PyArena Memory Arena . . . . . . . . . . . . . . . . 206 Reference Counting . . . . . . . . . . . . . . . . . . . . . 207 Garbage Collection . . . . . . . . . . . . . . . . . . . . . 214 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . 224 Parallelism and Concurrency 226 Models of Parallelism and Concurrency . . . . . . . . . . . 228 The Structure of a Process . . . . . . . . . . . . . . . . . . 228 Multi-Process Parallelism . . . . . . . . . . . . . . . . . . 231 Multithreading . . . . . . . . . . . . . . . . . . . . . . . 255 Asynchronous Programming . . . . . . . . . . . . . . . . 268 Generators . . . . . . . . . . . . . . . . . . . . . . . . . . 269 Coroutines . . . . . . . . . . . . . . . . . . . . . . . . . . 275 Asynchronous Generators . . . . . . . . . . . . . . . . . . 281 Subinterpreters . . . . . . . . . . . . . . . . . . . . . . . 282 Conclusion . . . . . . . . . . . . . . . . . . . . . . . . . . 286 10