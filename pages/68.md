The values produced by the async generator are a tuple of a coroutine function  `f` and an  `int` . Calling the coroutine function  `f()`  produces a coroutine, which must be evaluated with  `await` . Note that inside the comprehension, the use of  `await`  has nothing at all to do with the use of  `async for` : they are doing completely different things and acting on different objects entirely. ### Starting Up and Shutting Down (Gracefully!)
 Most async-based programs are going to be long-running, network-based applications. This domain holds a surprising amount of complexity in dealing with how to start up and shut down correctly. Of the two, startup is simpler. The standard way of starting up an  `asyncio`  application  is to have a  `main()`  coroutine function and call it with  `asyncio.run()` , as shown in Example 3-2  at the beginning of this chapter. Generally, startup will be fairly straightforward; for the server case described earlier, you can read more about it  in the docs . We’ll also briefly look at a demonstration of server startup in an upcoming code example. Shutdown is much more intricate. For shutdown, I previously covered the dance that happens inside  `asyncio.run()` . When the  `async def main()`  function exits, the following actions are taken: 1.  Collect all the still-pending task objects (if any). 2.  Cancel these tasks (this raises  `CancelledError`  inside each running coroutine, which you may choose to handle in a  `try/except`  within the body of the coroutine function). 3.  Gather all these tasks into a  *group*  task. 4.  Use  `run_until_complete()`  on the group task to wait for them to finish—i.e., let the  `CancelledError`  exception be raised and dealt with. `asyncio.run()`  performs these actions for you, but in spite of this assistance, a rite of passage in building your first few nontrivial  `asyncio`  apps is going to be trying to get rid of error messages like “Task was destroyed but it is pending!” during shutdown. This happens because your application was not expecting one or more of the preceding steps.  Example 3-29  is an example of a script that raises this annoying error. *Example 3-29. Destroyer of pending tasks* `# taskwarning.py` `import` ` ` `asyncio` **Starting Up and Shutting Down (Gracefully!) ** **| ** **57**