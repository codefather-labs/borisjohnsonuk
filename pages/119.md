I obtain our  `collector()`  coroutine off the  `app`  identifier and call  `cancel()`  on that. Finally, you can see where the custom startup and shutdown coroutines are hooked in: the  `app`  instance provides hooks to which our custom coroutines may be appended. All that remains is the visualization layer, shown in  Example 4-20 . I’m using the Smoothie Charts library  to generate scrolling charts, and the complete HTML for our main (and only) web page,  *charts.html* , is provided in the  Example B-1 . There is too much HTML, CSS, and JavaScript to present in this section, but I do want to highlight a few points about how the server-sent events are handled in JavaScript in the browser client. *Example 4-20. * *The* * visualization layer, which is a fancy way of saying “the browser”* `<` `snip` `>` `var` ` ` `evtSource` ` ` `=` ` ` `new` ` ` `EventSource` `(` `"/feed"` `);` `  ` `evtSource` `.` `onmessage` ` ` `=` ` ` `function` `(` `e` `)` ` ` `{` `    ` `var` ` ` `obj` ` ` `=` ` ` `JSON` `.` `parse` `(` `e` `.` `data` `);` `  ` `    ` `if` ` ` `(` `!` `(` `obj` `.` `color` ` ` `in` ` ` `cpu` `))` ` ` `{` `        ` `add_timeseries` `(` `cpu` `,` ` ` `cpu_chart` `,` ` ` `obj` `.` `color` `);` `    ` `}` `    ` `if` ` ` `(` `!` `(` `obj` `.` `color` ` ` `in` ` ` `mem` `))` ` ` `{` `        ` `add_timeseries` `(` `mem` `,` ` ` `mem_chart` `,` ` ` `obj` `.` `color` `);` `    ` `}` `    ` `cpu` `[` `obj` `.` `color` `].` `append` `(` `        ` `Date` `.` `parse` `(` `obj` `.` `timestamp` `),` ` ` `obj` `.` `cpu` `);` `  ` `    ` `mem` `[` `obj` `.` `color` `].` `append` `(` `        ` `Date` `.` `parse` `(` `obj` `.` `timestamp` `),` ` ` `obj` `.` `mem` `);` `};` `<` `snip` `>` Create a new  `EventSource()`  instance on the  */feed*  URL. The browser will connect to  */feed*  on our server, ( *metric_server.py* ). Note that the browser will automatically try to reconnect if the connection is lost. Server-sent events are often overlooked, but in many situations their simplicity makes them preferable to WebSockets. The  `onmessage`  event will fire every time the server sends data. Here the data is parsed as JSON. The  `cpu`  identifier is a mapping of a color to a  `TimeSeries()`  instance (for more on this, see  Example B-1 ). Here, we obtain that time series and append data to it. **108 ** **| ** **Chapter 4: 20 Asyncio Libraries You Aren’t Using (But…Oh, Never Mind)**