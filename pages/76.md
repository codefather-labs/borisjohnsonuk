In this case, only Ctrl-C will stop the loop. Then we handle  `KeyboardInterrupt` and do all the necessary cleanup bits, as covered in the previous sections. So far, that’s pretty straightforward. Now I’m going to complicate things. Suppose that: •  One of your colleagues asks that you please handle  `SIGTERM`  in addition to  `SIGINT` as a shutdown signal. •  In your real application, you need to do cleanup inside your  `main()`  coroutine; you will need to handle  `CancelledError` , and the cleanup code inside the exception handler will take several seconds to finish (imagine that you have to communicate with network peers and close a bunch of socket connections). •  Your app must not do weird things if you’re sent signals multiple times (such as rerunning any shutdown steps); after you receive the first shutdown signal, you want to simply ignore any new signals until exit. `asyncio`  provides enough granularity in the API to handle all these situations. Example 3-34  modifies the previous simple code example to include these new features. *Example 3-34. Handle both SIGINT and SIGTERM, but stop the loop only once* `# shell_signal02.py` `import` ` ` `asyncio` `from` ` ` `signal` ` ` `import` ` ` `SIGINT` `,` ` ` `SIGTERM` `  ` `async` ` ` `def` ` ` `main` `():` `    ` `try` `:` `        ` `while` ` ` `True` `:` `            ` `print` `(` `'<Your app is running>'` `)` `            ` `await` ` ` `asyncio` `.` `sleep` `(` `1` `)` `    ` `except` ` ` `asyncio` `.` `CancelledError` `:` `  ` `        ` `for` ` ` `i` ` ` `in` ` ` `range` `(` `3` `):` `            ` `print` `(` `'<Your app is shutting down...>'` `)` `            ` `await` ` ` `asyncio` `.` `sleep` `(` `1` `)` `def` ` ` `handler` `(` `sig` `):` `  ` `    ` `loop` `.` `stop` `()` `  ` `    ` `print` `(` `f` `'Got signal: ` `{sig!s}` `, shutting down.'` `)` `    ` `loop` `.` `remove_signal_handler` `(` `SIGTERM` `)` `  ` `    ` `loop` `.` `add_signal_handler` `(` `SIGINT` `,` ` ` `lambda` `:` ` ` `None` `)` `  ` `if` ` ` `__name__` ` ` `==` ` ` `'__main__'` `:` `    ` `loop` ` ` `=` ` ` `asyncio` `.` `get_event_loop` `()` `    ` `for` ` ` `sig` ` ` `in` ` ` `(` `SIGTERM` `,` ` ` `SIGINT` `):` `  ` `        ` `loop` `.` `add_signal_handler` `(` `sig` `,` ` ` `handler` `,` ` ` `sig` `)` **Starting Up and Shutting Down (Gracefully!) ** **| ** **65**