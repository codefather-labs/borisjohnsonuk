These themes repeat throughout: •  Threading makes code hard to reason about. •  Threading is an inefficient model for large-scale concurrency (thousands of concurrent tasks). Next, let’s look at a case study involving threads that highlights the first and most important point. ### Case Study: Robots and Cutlery
 Second, and more important, we did not (and still do not) believe in the standard multithreading model, which is preemptive concurrency with shared memory: we still think that no one can write correct programs in a language where “a = a + 1” is not deterministic. —Roberto Ierusalimschy et al.,  “The Evolution of Lua” At the start of this book, I told the story of a restaurant in which humanoid robots— ThreadBots—did all the work. In that analogy, each worker was a thread. In the case study in  Example 2-2 , we’re going to look at  *why*  threading is considered unsafe. *Example 2-2. * *ThreadBot* * programming for table service* `import` ` ` `threading` `from` ` ` `queue` ` ` `import` ` ` `Queue` `class` ` ` `ThreadBot` `(` `threading` `.` `Thread` `):` `  ` `  ` `def` ` ` `__init__` `(` `self` `):` `    ` `super` `()` `.` `__init__` `(` `target` `=` `self` `.` `manage_table` `)` `  ` `    ` `self` `.` `cutlery` ` ` `=` ` ` `Cutlery` `(` `knives` `=` `0` `,` ` ` `forks` `=` `0` `)` `  ` `    ` `self` `.` `tasks` ` ` `=` ` ` `Queue` `()` `  ` `  ` `def` ` ` `manage_table` `(` `self` `):` `    ` `while` ` ` `True` `:` `  ` `      ` `task` ` ` `=` ` ` `self` `.` `tasks` `.` `get` `()` `      ` `if` ` ` `task` ` ` `==` ` ` `'prepare table'` `:` `        ` `kitchen` `.` `give` `(` `to` `=` `self` `.` `cutlery` `,` ` ` `knives` `=` `4` `,` ` ` `forks` `=` `4` `)` ` ` `      ` `elif` ` ` `task` ` ` `==` ` ` `'clear table'` `:` `        ` `self` `.` `cutlery` `.` `give` `(` `to` `=` `kitchen` `,` ` ` `knives` `=` `4` `,` ` ` `forks` `=` `4` `)` `      ` `elif` ` ` `task` ` ` `==` ` ` `'shutdown'` `:` `        ` `return` A  `ThreadBot`  is a subclass of a thread. The target function of the thread is the  `manage_table()`  method, defined later in the file. **14 ** **| ** **Chapter 2: The Truth About Threads**