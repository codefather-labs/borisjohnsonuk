This  `add_route()`  call sends  `POST`  requests for the  `/patron`  URL to the `new_patron()`  coroutine function. This  `add_route()`  call sends  *all*  requests for the  `/patron/<id:int>`  URL to the `PatronAPI`  class-based view. The method names in that class determine which one is called: a  `GET`  HTTP request will call the  `PatronAPI.get()`  method, and so on. The preceding code contains all the HTTP handling for our server, as well as startup and shutdown tasks like setting up a connection pool to the database and, crucially, setting up a  `db-event`  listener on the  `chan_patron`  channel on the DB server. Example 4-24  presents the model for the  `patron`  table in the database. *Example 4-24. DB model for the “patron” table* `# model.py` `import` ` ` `logging` `from` ` ` `json` ` ` `import` ` ` `loads` `,` ` ` `dumps` `from` ` ` `triggers` ` ` `import` ` ` `(` `    ` `create_notify_trigger` `,` ` ` `add_table_triggers` `)` `  ` `from` ` ` `boltons.cacheutils` ` ` `import` ` ` `LRU` `  ` `logger` ` ` `=` ` ` `logging` `.` `getLogger` `(` `'perf'` `)` `CREATE_TABLE` ` ` `=` ` ` `(` `'CREATE TABLE IF NOT EXISTS patron('` `  ` `                ` `'id serial PRIMARY KEY, name text, '` `                ` `'fav_dish text)'` `)` `INSERT` ` ` `=` ` ` `(` `'INSERT INTO patron(name, fav_dish) '` `          ` `'VALUES ($1, $2) RETURNING id'` `)` `SELECT` ` ` `=` ` ` `'SELECT * FROM patron WHERE id = $1'` `UPDATE` ` ` `=` ` ` `'UPDATE patron SET name=$1, fav_dish=$2 WHERE id=$3'` `DELETE` ` ` `=` ` ` `'DELETE FROM patron WHERE id=$1'` `EXISTS` ` ` `=` ` ` `"SELECT to_regclass('patron')"` `CACHE` ` ` `=` ` ` `LRU` `(` `max_size` `=` `65536` `)` `  ` `async` ` ` `def` ` ` `add_patron` `(` `conn` `,` ` ` `data` `:` ` ` `dict` `)` ` ` `->` ` ` `int` `:` `  ` `    ` `return` ` ` `await` ` ` `conn` `.` `fetchval` `(` `        ` `INSERT` `,` ` ` `data` `[` `'name'` `],` ` ` `data` `[` `'fav_dish'` `])` `async` ` ` `def` ` ` `update_patron` `(` `conn` `,` ` ` `id` `:` ` ` `int` `,` ` ` `data` `:` ` ` `dict` `)` ` ` `->` ` ` `bool` `:` `    ` `result` ` ` `=` ` ` `await` ` ` `conn` `.` `execute` `(` `  ` `        ` `UPDATE` `,` ` ` `data` `[` `'name'` `],` ` ` `data` `[` `'fav_dish'` `],` ` ` `id` `)` `    ` `return` ` ` `result` ` ` `==` ` ` `'UPDATE 1'` `async` ` ` `def` ` ` `delete_patron` `(` `conn` `,` ` ` `id` `:` ` ` `int` `):` `  ` `    ` `result` ` ` `=` ` ` `await` ` ` `conn` `.` `execute` `(` `DELETE` `,` ` ` `id` `)` `    ` `return` ` ` `result` ` ` `==` ` ` `'DELETE 1'` **asyncpg and Sanic ** **| ** **123**