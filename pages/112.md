`Via PULL: 3` `Via SUB: 3` The code works; however, our interest here is not whether the code runs, but rather whether  `asyncio`  has anything to offer for the structure of  *poller.py* . The key thing to understand is that our  `asyncio`  code is going to run in a single thread, which means that it’s fine to handle different sockets in different  *coroutines* —and indeed, this is exactly what we’ll do. Of course,  someone had to do the hard work  to add support for coroutines into `pyzmq`  (the Python client library for ØMQ) itself for this to work, so it wasn’t free. But we can take advantage of that hard work to improve on the “traditional” code structure, as shown in  Example 4-17 . *Example 4-17. Clean separation with asyncio* `# poller_aio.py` `import` ` ` `asyncio` `import` ` ` `zmq` `from` ` ` `zmq.asyncio` ` ` `import` ` ` `Context` `context` ` ` `=` ` ` `Context` `()` `async` ` ` `def` ` ` `do_receiver` `():` `    ` `receiver` ` ` `=` ` ` `context` `.` `socket` `(` `zmq` `.` `PULL` `)` `  ` `    ` `receiver` `.` `connect` `(` `"tcp://localhost:5557"` `)` `    ` `while` ` ` `message` ` ` `:` `=` ` ` `await` ` ` `receiver` `.` `recv_json` `():` `  ` `        ` `print` `(` `f` `'Via PULL: ` `{message}` `'` `)` `async` ` ` `def` ` ` `do_subscriber` `():` `    ` `subscriber` ` ` `=` ` ` `context` `.` `socket` `(` `zmq` `.` `SUB` `)` `  ` `    ` `subscriber` `.` `connect` `(` `"tcp://localhost:5556"` `)` `    ` `subscriber` `.` `setsockopt_string` `(` `zmq` `.` `SUBSCRIBE` `,` ` ` `''` `)` `    ` `while` ` ` `message` ` ` `:` `=` ` ` `await` ` ` `subscriber` `.` `recv_json` `():` `  ` `        ` `print` `(` `f` `'Via SUB: ` `{message}` `'` `)` `async` ` ` `def` ` ` `main` `():` `    ` `await` ` ` `asyncio` `.` `gather` `(` `        ` `do_receiver` `(),` `        ` `do_subscriber` `(),` `    ` `)` `asyncio` `.` `run` `(` `main` `())` This code sample does the same as  Example 4-15 , except that now we’re taking advantage of coroutines to restructure everything. Now we can deal with each socket in isolation. I’ve created two coroutine functions, one for each socket; this one is for the  `PULL`  socket. **ØMQ (ZeroMQ) ** **| ** **101**