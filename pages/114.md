*Collection layer* The central server will expose a ØMQ socket to collect the data from all the running application instances. The server will also serve a web page to show performance graphs over time and will live-stream the data as it comes in. *Visualization layer* This is the web page being served. We’ll display the collected data in a set of charts, and the charts will live-update in real time. To simplify the code samples, I will use the convenient  Smoothie Charts  JavaScript library, which provides all the necessary client-side features. The backend app (application layer) that produces metrics is shown in  Example 4-18 . *Example 4-18. * *The* * application layer: producing metrics* `import` ` ` `argparse` `import` ` ` `asyncio` `from` ` ` `random` ` ` `import` ` ` `randint` `,` ` ` `uniform` `from` ` ` `datetime` ` ` `import` ` ` `datetime` ` ` `as` ` ` `dt` `from` ` ` `datetime` ` ` `import` ` ` `timezone` ` ` `as` ` ` `tz` `from` ` ` `contextlib` ` ` `import` ` ` `suppress` `import` ` ` `zmq` `,` ` ` `zmq.asyncio` `,` ` ` `psutil` `ctx` ` ` `=` ` ` `zmq` `.` `asyncio` `.` `Context` `()` `async` ` ` `def` ` ` `stats_reporter` `(` `color` `:` ` ` `str` `):` `  ` `    ` `p` ` ` `=` ` ` `psutil` `.` `Process` `()` `    ` `sock` ` ` `=` ` ` `ctx` `.` `socket` `(` `zmq` `.` `PUB` `)` `  ` `    ` `sock` `.` `setsockopt` `(` `zmq` `.` `LINGER` `,` ` ` `1` `)` `    ` `sock` `.` `connect` `(` `'tcp://localhost:5555'` `)` `  ` `    ` `with` ` ` `suppress` `(` `asyncio` `.` `CancelledError` `):` `  ` `        ` `while` ` ` `True` `:` `  ` `            ` `await` ` ` `sock` `.` `send_json` `(` `dict` `(` `  ` `                ` `color` `=` `color` `,` `                ` `timestamp` `=` `dt` `.` `now` `(` `tz` `=` `tz` `.` `utc` `)` `.` `isoformat` `(),` `  ` `                ` `cpu` `=` `p` `.` `cpu_percent` `(),` `                ` `mem` `=` `p` `.` `memory_full_info` `()` `.` `rss` ` ` `/` ` ` `1024` ` ` `/` ` ` `1024` `            ` `))` `            ` `await` ` ` `asyncio` `.` `sleep` `(` `1` `)` `    ` `sock` `.` `close` `()` `  ` `async` ` ` `def` ` ` `main` `(` `args` `):` `    ` `asyncio` `.` `create_task` `(` `stats_reporter` `(` `args` `.` `color` `))` `    ` `leak` ` ` `=` ` ` `[]` `    ` `with` ` ` `suppress` `(` `asyncio` `.` `CancelledError` `):` `        ` `while` ` ` `True` `:` `            ` `sum` `(` `range` `(` `randint` `(` `1` `_000` `,` ` ` `10` `_000_000` `)))` `  ` `            ` `await` ` ` `asyncio` `.` `sleep` `(` `uniform` `(` `0` `,` ` ` `1` `))` `            ` `leak` ` ` `+=` ` ` `[` `0` `]` ` ` `*` ` ` `args` `.` `leak` **ØMQ (ZeroMQ) ** **| ** **103**