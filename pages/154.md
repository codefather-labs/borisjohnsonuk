The second function,  `add_table_triggers()` , connects the trigger function to table events like insert, update, and delete. There are three format strings for each of the three methods. The desired variables are substituted into the templates and then executed. This SQL code took me a lot longer than expected to get exactly right! This PostgreSQL procedure is called for insert, update, and delete events; the way to know which is to check the  `TG_OP`  variable. If the operation is  `INSERT` , then  `NEW` will be defined (and  `OLD`  will  *not*  be defined). For  `DELETE` ,  `OLD`  will be defined but not  `NEW` . For  `UPDATE` , both are defined, which allows us to calculate the diff. We also make use of PostgreSQLâ€™s built-in support for JSON with the  `row_to_json()` and  `hstore_to_json()`  functions: these mean that our callback handler will receive valid JSON. Finally, the call to the  `pg_notify()`  function is what actually sends the event.  *All* *subscribers*  on  `{channel}`  will receive the notification. This is standard trigger code: it sets up a trigger to call a specific procedure  `{trig` `ger_name}()`  when a specific event occurs, like an  `INSERT`  or an  `UPDATE` . There are sure to be many useful applications that can be built around notifications received from PostgreSQL. ### Supplementary Material for the Sanic Example: aelapsed
 ### and 
 ### aprofiler
 The Sanic case study (see  *asyncpg*  case study ) included utility decorators for printing out elapsed time taken by a function. These are shown in  Example B-5 . *Example B-5. perf.py* `# perf.py` `import` ` ` `logging` `from` ` ` `time` ` ` `import` ` ` `perf_counter` `from` ` ` `inspect` ` ` `import` ` ` `iscoroutinefunction` `logger` ` ` `=` ` ` `logging` `.` `getLogger` `(` `'perf'` `)` `def` ` ` `aelapsed` `(` `corofn` `,` ` ` `caption` `=` `''` `):` `  ` `    ` `async` ` ` `def` ` ` `wrapper` `(` `*` `args` `,` ` ` `**` `kwargs` `):` `        ` `t0` ` ` `=` ` ` `perf_counter` `()` `        ` `result` ` ` `=` ` ` `await` ` ` `corofn` `(` `*` `args` `,` ` ` `**` `kwargs` `)` `        ` `delta` ` ` `=` ` ` `(` `perf_counter` `()` ` ` `-` ` ` `t0` `)` ` ` `*` ` ` `1e3` **Supplementary Material ** **| ** **143**