
![page_106_0](images/page_106_0.png)
 To obtain and run the Splash container, run these commands in your shell: `$ ` `docker pull scrapinghub/splash` `$ ` `docker run --rm -p 8050:8050 scrapinghub/splash` Our server backend will call the Splash API at  *http://localhost:8050* . *Example 4-14. Code for the news scraper* `from` ` ` `asyncio` ` ` `import` ` ` `gather` `,` ` ` `create_task` `from` ` ` `string` ` ` `import` ` ` `Template` `from` ` ` `aiohttp` ` ` `import` ` ` `web` `,` ` ` `ClientSession` `from` ` ` `bs4` ` ` `import` ` ` `BeautifulSoup` `async` ` ` `def` ` ` `news` `(` `request` `):` `  ` `    ` `sites` ` ` `=` ` ` `[` `        ` `(` `'http://edition.cnn.com'` `,` ` ` `cnn_articles` `),` `  ` `        ` `(` `'http://www.aljazeera.com'` `,` ` ` `aljazeera_articles` `),` `    ` `]` `    ` `tasks` ` ` `=` ` ` `[` `create_task` `(` `news_fetch` `(` `*` `s` `))` ` ` `for` ` ` `s` ` ` `in` ` ` `sites` `]` ` ` `    ` `await` ` ` `gather` `(` `*` `tasks` `)` `  ` `    ` `items` ` ` `=` ` ` `{` `  ` `        ` `text` `:` ` ` `(` `  ` `            ` `f` `'<div class="box ` `{kind}` `">'` `            ` `f` `'<span>'` `            ` `f` `'<a href="` `{href}` `">` `{text}` `</a>'` `            ` `f` `'</span>'` `            ` `f` `'</div>'` `        ` `)` `        ` `for` ` ` `task` ` ` `in` ` ` `tasks` ` ` `for` ` ` `href` `,` ` ` `text` `,` ` ` `kind` ` ` `in` ` ` `task` `.` `result` `()` `    ` `}` `    ` `content` ` ` `=` ` ` `''` `.` `join` `(` `items` `[` `x` `]` ` ` `for` ` ` `x` ` ` `in` ` ` `sorted` `(` `items` `))` `    ` `page` ` ` `=` ` ` `Template` `(` `open` `(` `'index.html'` `)` `.` `read` `())` `  ` `    ` `return` ` ` `web` `.` `Response` `(` `        ` `body` `=` `page` `.` `safe_substitute` `(` `body` `=` `content` `),` `  ` `        ` `content_type` `=` `'text/html'` `,` `    ` `)` `async` ` ` `def` ` ` `news_fetch` `(` `url` `,` ` ` `postprocess` `):` `    ` `proxy_url` ` ` `=` ` ` `(` `        ` `f` `'http://localhost:8050/render.html?'` `  ` `        ` `f` `'url=` `{url}` `&timeout=60&wait=1'` `    ` `)` `    ` `async` ` ` `with` ` ` `ClientSession` `()` ` ` `as` ` ` `session` `:` `        ` `async` ` ` `with` ` ` `session` `.` `get` `(` `proxy_url` `)` ` ` `as` ` ` `resp` `:` `  ` `            ` `data` ` ` `=` ` ` `await` ` ` `resp` `.` `read` `()` `            ` `data` ` ` `=` ` ` `data` `.` `decode` `(` `'utf-8'` `)` `    ` `return` ` ` `postprocess` `(` `url` `,` ` ` `data` `)` `  ` **aiohttp ** **| ** **95**