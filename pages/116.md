The  `main()`  function symbolizes the actual microservice application. Fake work is produced with this sum over random numbers, just to give us some nonzero data to view in the visualization layer a bit later. I’m going to create multiple instances of this application, so it will be convenient to be able to distinguish between them (later, in the graphs) with a  `--color` parameter. Finally, the ØMQ context can be terminated. The primary point of interest is the  `stats_reporter()`  function. This is what streams out metrics data (collected by the useful  `psutil`  library). The rest of the code can be assumed to be a typical microservice application. The server code in  Example 4-19  collects all the data and serves it to a web client. *Example 4-19. * *The* * collection layer: this server collects process stats* `# metric-server.py` `import` ` ` `asyncio` `from` ` ` `contextlib` ` ` `import` ` ` `suppress` `import` ` ` `zmq` `import` ` ` `zmq.asyncio` `import` ` ` `aiohttp` `from` ` ` `aiohttp` ` ` `import` ` ` `web` `from` ` ` `aiohttp_sse` ` ` `import` ` ` `sse_response` `from` ` ` `weakref` ` ` `import` ` ` `WeakSet` `import` ` ` `json` `# zmq.asyncio.install()` `ctx` ` ` `=` ` ` `zmq` `.` `asyncio` `.` `Context` `()` `connections` ` ` `=` ` ` `WeakSet` `()` `  ` `async` ` ` `def` ` ` `collector` `():` `    ` `sock` ` ` `=` ` ` `ctx` `.` `socket` `(` `zmq` `.` `SUB` `)` `  ` `    ` `sock` `.` `setsockopt_string` `(` `zmq` `.` `SUBSCRIBE` `,` ` ` `''` `)` `  ` `    ` `sock` `.` `bind` `(` `'tcp://*:5555'` `)` `  ` `    ` `with` ` ` `suppress` `(` `asyncio` `.` `CancelledError` `):` `        ` `while` ` ` `data` ` ` `:` `=` ` ` `await` ` ` `sock` `.` `recv_json` `():` `  ` `            ` `print` `(` `data` `)` `            ` `for` ` ` `q` ` ` `in` ` ` `connections` `:` `                ` `await` ` ` `q` `.` `put` `(` `data` `)` `  ` `    ` `sock` `.` `close` `()` `async` ` ` `def` ` ` `feed` `(` `request` `):` `  ` `    ` `queue` ` ` `=` ` ` `asyncio` `.` `Queue` `()` `    ` `connections` `.` `add` `(` `queue` `)` `  ` `    ` `with` ` ` `suppress` `(` `asyncio` `.` `CancelledError` `):` `        ` `async` ` ` `with` ` ` `sse_response` `(` `request` `)` ` ` `as` ` ` `resp` `:` `  ` **ØMQ (ZeroMQ) ** **| ** **105**