`async` ` ` `def` ` ` `f` `(` `delay` `):` `    ` `await` ` ` `asyncio` `.` `sleep` `(` `delay` `)` `loop` ` ` `=` ` ` `asyncio` `.` `get_event_loop` `()` `t1` ` ` `=` ` ` `loop` `.` `create_task` `(` `f` `(` `1` `))` `  ` `t2` ` ` `=` ` ` `loop` `.` `create_task` `(` `f` `(` `2` `))` `  ` `loop` `.` `run_until_complete` `(` `t1` `)` ` ` `loop` `.` `close` `()` Task 1 will run for 1 second. Task 2 will run for 2 seconds. Run only until task 1 is complete. Running it produces the following output: `$ ` `python taskwarning.py` `Task was destroyed but it is pending!` `task: <Task pending coro=<f() done, defined at [...snip...]>` This error is telling you that some tasks had not yet been completed when the loop was closed. We want to avoid this, and that is why the idiomatic shutdown procedure is to collect all unfinished tasks, cancel them, and then let them all finish  *before*  closing the loop.  `asyncio.run()`  does all of these steps for you, but it is important to understand the process in detail so that you will be able to handle more complex situations. Letâ€™s look at a more detailed code sample that illustrates all these phases. Example 3-30  is a mini case study with a Telnet-based echo server. *Example 3-30. Asyncio application life cycle (based on the TCP echo server in the* *Python documentation)* `# telnetdemo.py` `import` ` ` `asyncio` `from` ` ` `asyncio` ` ` `import` ` ` `StreamReader` `,` ` ` `StreamWriter` `async` ` ` `def` ` ` `echo` `(` `reader` `:` ` ` `StreamReader` `,` ` ` `writer` `:` ` ` `StreamWriter` `):` ` ` `    ` `print` `(` `'New connection.'` `)` `    ` `try` `:` `        ` `while` ` ` `data` ` ` `:` `=` ` ` `await` ` ` `reader` `.` `readline` `():` `  ` `            ` `writer` `.` `write` `(` `data` `.` `upper` `())` `  ` `            ` `await` ` ` `writer` `.` `drain` `()` `        ` `print` `(` `'Leaving Connection.'` `)` `    ` `except` ` ` `asyncio` `.` `CancelledError` `:` `  ` `        ` `print` `(` `'Connection dropped!'` `)` `async` ` ` `def` ` ` `main` `(` `host` `=` `'127.0.0.1'` `,` ` ` `port` `=` `8888` `):` **58 ** **| ** **Chapter 3: Asyncio Walk-Through**