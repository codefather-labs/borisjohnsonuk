Proﬁle Guided Optimization Note The PGO process is time-consuming, so throughout this book I’ve excluded it from the list of recommended steps to keep your compilation time short. If you want to distribute a custom compiled version of CPython into a production environment, you should run  ./configure  with the  --with-pgo  flag in Linux and macOS, and use the  --pgo  flag in  build.bat  on Windows. Because the optimizations are speciﬁc to the platform and architecture that the proﬁle was executed on, PGO proﬁles cannot be shared between operating systems or CPU architectures. The distributions of CPython on python.org have already been through PGO, so if you run a benchmark on a vanilla-compiled binary it will be slower than one downloaded from python.org. The Windows, macOS and Linux proﬁle-guided optimizations include these checks and improvements: •  Function Inlining  - If a function is regularly called from another function, then it will be “inlined” to reduce the stack-size. •  Virtual Call Speculation and Inlining  - If a virtual function call frequently targets a certain function, PGO can insert a conditionally executed direct call to that function. The direct call can then be inlined. •  Register Allocation Optimization  - Based on proﬁle data results, the PGO will optimize register allocation. •  Basic Block Optimization  - Basic block optimization allows commonly executed basic blocks that temporally execute within a given frame to be placed in the same set of pages (locality). It minimizes the number of pages used, which minimizes memory overhead. •  Hot-Spot Optimization  - Functions where the program spends the most execution time can be optimized for speed. •  Function Layout Optimization  - After analyzing the call graph, 59